<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solace PubSub+ Container Run Command Builder</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<header class="header">
  <img src="solace-logo.png" alt="Solace" class="logo" />
  <h1>PubSub+ Container Run Command Builder</h1>
</header>

<main class="container">

  <!-- Deployment -->
  <details open class="card">
    <summary>Deployment Mode</summary>
    <p class="section-desc">The Solace Event Broker can be deployed in two modes:</p>
    <p class="section-desc">1. A single <i>Standalone</i> instance, suitable for quickly getting started for developer environments.</p>
    <p class="section-desc">2. A <i>High Availability</i> deployment of 3 nodes (a.k.a "a triplet"), consisting of a primary and backup messaging nodes, and a single monitor node to prevent split-brain activation.</p>
    <label>
      Deployment Mode
      <select id="mode">
        <option value="standalone" selected>Standalone</option>
        <option value="ha">High Availability</option>
      </select>
    </label>
  </details>

  <!-- Runtime, Image Repo and Restart Policy -->
  <details open class="card">
    <summary>Container Runtime, Image Repository and Restart Policy</summary>
    <p class="section-desc">Solace supports <code>docker</code> and <code>podman</code> as <a href="https://docs.solace.com/Software-Broker/SW-Broker-Set-Up/Containers/Deploying-Container-in-Production.htm#configuring-the-container-runtime" target="_blank">container runtimes</a>, and the image can be pulled from Docker Hub.</p>
    <p class="section-desc">It is important for instances of Solace containers to <a href="https://docs.solace.com/Software-Broker/SW-Broker-Set-Up/Containers/Deploying-Container-in-Production.htm#configuring-the-container-to-start-automatically" target="_blank">restart automatically</a> in the case of a crash or host reboot so set a restart policy accordingly.</p>
    <p class="section-desc">The default user ID in a Solace container is <a href="https://docs.solace.com/Software-Broker/Container-Tasks/Config-Arbitrary-User.htm#Configuring_Container_Users" target="_blank">1000001.</a>. You can provide a specific UID available on the host machine if required to override this.</p>

    <div class="form-grid">
      <!-- Row 1: Container Runtime (full row) -->
      <label for="runtime">Container Runtime</label>
      <select id="runtime" class="span-to-end">
        <option value="docker">docker</option>
        <option value="podman">podman</option>
      </select>

      <!-- Row 2: Image path + version -->
      <label for="image_path">Image Repository Path</label>
      <input id="image_path" value="docker.io/solace/solace-pubsub-standard" />

      <label for="image_version">Image Version</label>
      <input id="image_version" value="latest" />

      <!-- Row 3: Restart policy + UID -->
      <label for="restart_policy">Restart Policy</label>
      <select id="restart_policy">
        <option value="">none</option>
        <option value="unless-stopped" selected>unless-stopped</option>
        <option value="always">always</option>
        <option value="on-failure">on-failure</option>
      </select>

      <label for="uid">Run as UID:GID</label>
      <input id="uid" placeholder="1000001:0" />
    </div>
  </details>

  <!-- Networking -->
  <details open class="card">
    <summary>Networking Configuration</summary>
    <p class="section-desc">The choice of <a href="https://docs.solace.com/Software-Broker/SW-Broker-Set-Up/Containers/Deploying-Container-in-Production.htm#networking" target="_blank">networking mode</a> is an important consideration when deploying Solace containers.</p>
    <p class="section-desc">1. bridge networking: the container is deployed in a separate network namespace from the host, with port forwarding rules.</p>
    <p class="section-desc">2. host networking: the container is deployed in the hostâ€™s network namespace.</p>
    <p class="section-desc">3. slirp4netns networking: suitable if running rootless containers with podman.</p>

    <label>
      Network Mode
      <select id="network_mode">
        <option value="bridge" selected>bridge</option>
        <option value="host">host</option>
        <option value="slirp4netns">slirp4netns</option>
      </select>
    </label>
  </details>

  <!-- Storage -->
  <details open class="card">
    <summary>Container Storage Configuration</summary>
    <p class="section-desc">The state information associated with a Solace container should be externalised to a filesystem mount on the host machine for <a href="https://docs.solace.com/Software-Broker/SW-Broker-Set-Up/Containers/Deploying-Container-in-Production.htm#configuring-storage" target="_blank">performance and ease of management</a> in the future (as some of this data is long lived.)</p>
    <p class="section-desc">The storage path on the host will be mounted to <code>/var/lib/solace</code> in the container's filesystem and will need to be built with XFS.</p>

    <label>Storage Path on Host
      <input id="storage_path" placeholder="/mnt/extfs/containers/solace/storage-group" />
    </label>

    <!-- Only show when runtime=podman AND network_mode=slirp4netns -->
    <div id="storage_tip_podman_slirp" class="tip-box" style="display:none;">
      <div class="tip-title">ðŸ’¡ Top Tip</div>
      <p>
        If running rootless containers (with <code>podman</code>), take extra care to manage the directory permissions of the above path.
      </p>
      <p>
        The filesystem inside the Solace container is owned by root, and attempts to write to a location owned by an unprivileged user on the host will fail.
      </p>
      <p>
        Use the command
        <code>"podman unshare chown -R &lt;container-UID&gt;:&lt;container-GID&gt; /path/to/host/storage"</code>
        so the container can write to it. See <a href="https://docs.solace.com/Software-Broker/Container-Tasks/Config-Container-Storage.htm#directory-ownership-with-rootless-containers"
           target="_blank">the documentation</a> for more information.
      </p>
    </div>
  </details>

  <!-- Password -->
  <details open class="card">
    <summary>Password Configuration</summary>
    <p class="section-desc">When a Solace container is started, a default user for admin access can be created to allow immediate usage for CLI login or the Management UI.</p>
    <p class="section-desc">This user will be called <code>admin</code> with the initial password possible to be supplied in one of three ways:</p>
    <p class="section-desc">1. Plain text string: suitable for quick-start developer environments.</p>
    <p class="section-desc">2. Password file path: a file on the host filesystem to read for the password.</p>
    <p class="section-desc">3. Encrypted password: provide a previously encrypted password. SHA-512 is supported. Salt prior to hashing. Format: <code>$6$salt$hashed-password</code> </p>

    <label>
      Password Input Method
      <select id="password_method">
        <option value="password" selected>password</option>
        <option value="password_file">password file path</option>
        <option value="encrypted_password">encrypted password</option>
      </select>
    </label>

    <label>
      Password Value / Path
      <input id="pw_value" placeholder="Enter password, path, or encrypted value" value="mysecret">
    </label>
  </details>

  <!-- Ports -->
  <details open class="card">
    <summary>Protocols and Port Forwarding</summary>
    <p class="section-desc">As Solace is a multi-protocol broker, the services are provided over a number of different ports.</p>
    <p class="section-desc">Select the protocols you intend to use so that the port forwarding rules can be constructed between the container's network namespace and the host network.</p>

    <div class="ports-toolbar">
      <div class="ports-actions">
        <button type="button" class="ports-btn" onclick="clearPorts()" title="Unchecks all protocol ports.">Clear all</button>
        <button type="button" class="ports-btn ports-btn-primary" title="Selects the recommended minimum." onclick="recommendedPorts()">Recommended minimum</button>
      </div>
    </div>
    <br/>
    <div class="ports-groups">
      <!-- SMF -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>Solace Messaging Protocol (SMF)</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="55555,55443" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="55555" /></td>
            <td class="ports-label">SMF (Plain)</td>
            <td class="ports-port">55555</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="55443" /></td>
            <td class="ports-label">SMF (Secure TLS)</td>
            <td class="ports-port">55443</td>
          </tr>
        </table>
      </section>

      <!-- Web Messaging -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>Solace Messaging (SMF) over WebSocket</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="8008,1443" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="8008" /></td>
            <td class="ports-label">WebSocket (Plain)</td>
            <td class="ports-port">8008</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="1443" /></td>
            <td class="ports-label">WebSocket (Secure TLS)</td>
            <td class="ports-port">1443</td>
          </tr>
        </table>
      </section>

      <!-- AMQP -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>AMQP</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="5672,5671" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="5672" /></td>
            <td class="ports-label">AMQP (Plain)</td>
            <td class="ports-port">5672</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="5671" /></td>
            <td class="ports-label">AMQP (Secure TLS)</td>
            <td class="ports-port">5671</td>
          </tr>
        </table>
      </section>

      <!-- MQTT -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>MQTT</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="1883,8883,8000,8443" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="1883" /></td>
            <td class="ports-label">MQTT (Plain)</td>
            <td class="ports-port">1883</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="8883" /></td>
            <td class="ports-label">MQTT (Secure TLS)</td>
            <td class="ports-port">8883</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="8000" /></td>
            <td class="ports-label">MQTT WebSocket (Plain)</td>
            <td class="ports-port">8000</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="8443" /></td>
            <td class="ports-label">MQTT WebSocket (Secure TLS)</td>
            <td class="ports-port">8443</td>
          </tr>
        </table>
      </section>

      <!-- REST -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>REST/HTTP Messaging</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="9000,9443" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="9000" /></td>
            <td class="ports-label">REST (Plain)</td>
            <td class="ports-port">9000</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="9443" /></td>
            <td class="ports-label">REST (Secure TLS)</td>
            <td class="ports-port">9443</td>
          </tr>
        </table>
      </section>

      <!-- SEMP -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>SEMP (Management API)</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="8080,1943" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="8080" /></td>
            <td class="ports-label">SEMP (Plain)</td>
            <td class="ports-port">8080</td>
          </tr>
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="1943" /></td>
            <td class="ports-label">SEMP (Secure TLS)</td>
            <td class="ports-port">1943</td>
          </tr>
        </table>
      </section>

      <!-- CLI -->
      <section class="ports-group">
        <div class="ports-group-header">
          <h3>Command Line Interface over SSH</h3>
          <button type="button" class="ports-btn ports-btn-toggle" title="Selects or clears all ports in this protocol group." data-toggle-ports="2222" onclick="toggleProtocolFromAttr(this)">Select all</button>
        </div>
        <table class="ports-table">
          <tr>
            <td class="ports-check"><input type="checkbox" data-port="2222" /></td>
            <td class="ports-label">CLI (SSH)</td>
            <td class="ports-port">2222</td>
          </tr>
        </table>
      </section>
    </div>
    <br/>
    <small>Note: Additiomal ports related to communication between HA nodes are automatically included when HA mode is selected and are not explicitly shown here.</small>
  </details>

  <!-- Scaling -->
  <details open class="card">
    <summary>Scaling Parameters</summary>
    <p class="section-desc">A Solace broker can be deployed in multiple <a href="https://docs.solace.com/Software-Broker/System-Scaling-Parameters.htm" target="_blank">scaling tiers</a>, with capacity limits and host resource usage matching the intended use-case.</p>
    <p class="section-desc">Use the <a href="https://docs.solace.com/Admin-Ref/Resource-Calculator/pubsubplus-resource-calculator.html" target="_blank">System Resource Calculator</a> to input your desired usage and generate the correct scaling parameters to pass to the container on startup.</p>
    <p class="section-desc">After using the calculator, enter the generated string into the field below. (Note: The current contents are suitable for a minimal size developer instance.)</p>

    <label>
      Scaling Arguments
      <textarea id="scaling_params" rows="4">--ulimit core=-1 --ulimit nofile=2448:1048576 --shm-size=1g --env system_scaling_maxconnectioncount=100 --env system_scaling_maxqueuemessagecount=100 --env system_scaling_maxkafkabridgecount=0 --env system_scaling_maxkafkabrokerconnectioncount=0 --env system_scaling_maxbridgecount=25 --env system_scaling_maxsubscriptioncount=50000 --env system_scaling_maxguaranteedmessagesize=10 --env messagespool_maxspoolusage=1500</textarea>
    </label>
  </details>

  <!-- Standalone -->
  <details open id="standalone_section" class="card">
    <summary>Standalone Broker Configuration</summary>
    <p class="section-desc">For the simple standalone instance, provide a suitable name for the container to use in the generated run command.</p>
    <label>
      Broker and Container Name
      <input id="standalone_name" value="solace1p" />
    </label>
  </details>

  <!-- HA -->
  <details id="ha_section" class="card" style="display:none">
    <summary>High Availability Configuration</summary>
    <p class="section-desc">When deploying a <a href="https://docs.solace.com/Features/HA-Redundancy/SW-Broker-Redundancy-and-Fault-Tolerance.htm" target="_blank">High Availability triplet</a> of Solace containers, they are configured with awareness of each other in terms of name and network location.</p>
    <p class="section-desc">Provide a suitable name for each of the nodes to deploy, along with an IP address or fully qualified domain name (FQDN) on how each node may connect to the other 2.</p>

    <table class="ha-table">
      <thead>
        <tr>
          <th>Node</th>
          <th>Broker and Container Name</th>
          <th>Host IP address or FQDN</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Primary node</td>
          <td><input id="ha_primary_name" value="solace1p" /></td>
          <td><input id="ha_primary_host" value="solace1p.mydomain.net" /></td>
        </tr>
        <tr>
          <td>Backup node</td>
          <td><input id="ha_backup_name" value="solace1b" /></td>
          <td><input id="ha_backup_host" value="solace1b.mydomain.net" /></td>
        </tr>
        <tr>
          <td>Monitor node</td>
          <td><input id="ha_monitor_name" value="solace1m" /></td>
          <td><input id="ha_monitor_host" value="solace1m.mydomain.net" /></td>
        </tr>
      </tbody>
    </table>

    <p class="section-desc">Every node is also configured with a Pre-Shared Authentication Key to allow each to connect to another.</p>
    <p class="section-desc">This is 44 to 344 characters (which translates into 32 to 256 bytes of binary data encoded in base 64) and can be generated below.</p>

    <div class="ha-psk-block">
      <label for="ha_psk_value">Pre-shared key</label>

      <div class="ha-psk-keyline">
        <input id="ha_psk_value" type="text" placeholder="Click Generate to create a secure key (44â€“344 chars)" autocomplete="off" />
        <button type="button" class="ports-btn" onclick="generateHaPsk()">Generate</button>
      </div>

      <label for="ha_psk_mode">Provide pre-shared key using</label>
      <select id="ha_psk_mode">
        <option value="direct" selected>Argument value</option>
        <option value="file">File path</option>
      </select>

      <div id="ha_psk_file_row" style="display:none;">
        <label for="ha_psk_filepath">Pre-shared key file path</label>
        <input id="ha_psk_filepath" type="text" placeholder="/path/to/presharedkey.txt" autocomplete="off" value="/tmp/solace-psk.txt" />
        <small class="ha-psk-help">Copy the pre-shared key value above into this file before starting the containers.</small>
      </div>
    </div>
  </details>

  <!-- TLS Server Certificate (optional) -->
  <details class="card">
    <summary>TLS Server Certificate</summary>
    <p class="section-desc">If setting up your broker to use TLS connections, provide a server certificate file path, and optionally a passphrase file path if the certificate is encrypted.</p>

    <label for="tls_servercertificate_filepath">Certificate file path</label>
    <input id="tls_servercertificate_filepath" type="text" placeholder="/path/to/server-certificate.p12" autocomplete="off" />

    <label for="tls_servercertificate_passphrasefilepath">Passphrase file path (optional)</label>
    <input id="tls_servercertificate_passphrasefilepath" type="text" placeholder="/path/to/passphrase.txt" autocomplete="off" />
  </details>

  <!-- OUTPUT -->
  <section class="card">
    <div class="output-header-row">
      <h2 class="output-title">Generated Output</h2>

      <label class="output-format">
        Output format
        <select id="output_format">
          <option value="run" selected>Run Commands</option>
          <option value="compose">Docker Compose (per-host)</option>
        </select>
      </label>
    </div>

    <!-- RUN COMMAND OUTPUTS -->
    <div id="run_outputs">
      <div id="out-standalone" class="output-box">
        <header>
          Standalone node container start command
          <button type="button" onclick="copyOut('output')">Copy</button>
        </header>
        <pre id="output"></pre>
      </div>

      <div id="out-primary" class="output-box" style="display:none">
        <header>
          Primary node container start command
          <button type="button" onclick="copyOut('output-primary')">Copy</button>
        </header>
        <pre id="output-primary"></pre>
      </div>

      <div id="out-backup" class="output-box" style="display:none">
        <header>
          Backup node container start command
          <button type="button" onclick="copyOut('output-backup')">Copy</button>
        </header>
        <pre id="output-backup"></pre>
      </div>

      <div id="out-monitor" class="output-box" style="display:none">
        <header>
          Monitor node container start command
          <button type="button" onclick="copyOut('output-monitor')">Copy</button>
        </header>
        <pre id="output-monitor"></pre>
      </div>

      <div id="ha-post-deploy-tips" class="tip-box">
        <div class="tip-title">ðŸ’¡ Top Tip</div>
        <p>
          After deploying a High-Availability broker group, you need to designate one of the brokers as the config-sync 'leader' after all are successfully running.
        </p>
        <p>
          See <a href="https://docs.solace.com/Features/Config-Sync/Configuring-Config-Sync.htm#Assertin" target="_blank">here</a> for more instructions.
        </p>
      </div>
    </div>

    <!-- COMPOSE YAML OUTPUTS -->
    <div id="compose_outputs" style="display:none">
      <div id="compose-out-standalone" class="output-box">
        <header>
          Standalone node docker-compose.yml (deploy on standalone host)
          <div class="out-actions">
            <button type="button" onclick="copyOut('compose-standalone')">Copy</button>
            <button type="button" class="btn-secondary" onclick="downloadOut('compose-standalone','docker-compose.yml')">Download</button>
          </div>
        </header>
        <pre id="compose-standalone"></pre>
      </div>

      <div id="compose-out-primary" class="output-box" style="display:none">
        <header>
          Primary node docker-compose.yml (deploy on primary host)
          <div class="out-actions">
            <button type="button" onclick="copyOut('compose-primary')">Copy</button>
            <button type="button" class="btn-secondary" onclick="downloadOut('compose-primary','docker-compose-primary.yml')">Download</button>
          </div>
        </header>
        <pre id="compose-primary"></pre>
      </div>

      <div id="compose-out-backup" class="output-box" style="display:none">
        <header>
          Backup node docker-compose.yml (deploy on backup host)
          <div class="out-actions">
            <button type="button" onclick="copyOut('compose-backup')">Copy</button>
            <button type="button" class="btn-secondary" onclick="downloadOut('compose-backup','docker-compose-backup.yml')">Download</button>
          </div>
        </header>
        <pre id="compose-backup"></pre>
      </div>

      <div id="compose-out-monitor" class="output-box" style="display:none">
        <header>
          Monitor node docker-compose.yml (deploy on monitor host)
          <div class="out-actions">
            <button type="button" onclick="copyOut('compose-monitor')">Copy</button>
            <button type="button" class="btn-secondary" onclick="downloadOut('compose-monitor','docker-compose-monitor.yml')">Download</button>
          </div>
        </header>
        <pre id="compose-monitor"></pre>
      </div>
    </div>
  </section>

</main>

<script src="app.js"></script>
<script>
  function copyOut(preId) {
    const el = document.getElementById(preId);
    const text = (el && el.innerText) ? el.innerText : "";
    navigator.clipboard.writeText(text);
  }

  function downloadOut(preId, filename) {
    const el = document.getElementById(preId);
    const text = (el && el.innerText) ? el.innerText : "";
    const blob = new Blob([text], { type: "text/yaml;charset=utf-8" });

    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename || "docker-compose.yml";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
